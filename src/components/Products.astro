---
import Productos1 from "../assets/products/Productos 1.png";
import Productos2 from "../assets/products/Productos 2.png";
import Productos3 from "../assets/products/Productos 3.png";
import Productos4 from "../assets/products/Productos 4.png";
import Productos5 from "../assets/products/Productos 5.png";
import Productos6 from "../assets/products/Productos 6.png";
import All from "../assets/products/Productos All.png";

import Logo from "../assets/products/Productos Hero.png";
import left from "../assets/products/Productos left.png";
import right from "../assets/products/Productos right.png";
import WhatsappParticipa from "./WhatsappParticipa.astro";
---

<section class="container mx-auto py-16 px-4 relative z-20">
	<!-- Top Left Logo -->
	<div class="mb-8 flex justify-start relative z-50">
		<img
			src={Logo.src}
			alt="Product Logo"
			class="h-40 w-auto object-contain"
		/>
	</div>

	<!-- Carousel Container -->
	<div class="relative px-2 md:px-16">
		<!-- Controls (Buttons on side) -->
		<button
			id="prev-btn"
			class="absolute left-0 top-1/2 -translate-y-1/2 z-10 hover:scale-110 transition-transform cursor-pointer focus:outline-none"
			aria-label="Previous"
		>
			<img src={left.src} alt="Previous" />
		</button>
		<button
			id="next-btn"
			class="absolute right-0 top-1/2 -translate-y-1/2 z-10 hover:scale-110 transition-transform cursor-pointer focus:outline-none"
			aria-label="Next"
		>
			<img src={right.src} alt="Next" />
		</button>

		<!-- Viewport -->
		<div class="overflow-hidden">
			<!-- Track -->
			<div
				id="carousel-track"
				class="flex transition-transform duration-500 ease-out"
			>
				<!-- Items 1-6 -->
				<div
					class="w-full md:w-1/3 shrink-0 px-3 flex items-center justify-center"
				>
					<img
						src={Productos1.src}
						alt="Producto 1"
						class="w-full h-auto object-contain"
					/>
				</div>
				<div
					class="w-full md:w-1/3 shrink-0 px-3 flex items-center justify-center"
				>
					<img
						src={Productos2.src}
						alt="Producto 2"
						class="w-full h-auto object-contain"
					/>
				</div>
				<div
					class="w-full md:w-1/3 shrink-0 px-3 flex items-center justify-center"
				>
					<img
						src={Productos3.src}
						alt="Producto 3"
						class="w-full h-auto object-contain"
					/>
				</div>
				<div
					class="w-full md:w-1/3 shrink-0 px-3 flex items-center justify-center"
				>
					<img
						src={Productos4.src}
						alt="Producto 4"
						class="w-full h-auto object-contain"
					/>
				</div>
				<div
					class="w-full md:w-1/3 shrink-0 px-3 flex items-center justify-center"
				>
					<img
						src={Productos5.src}
						alt="Producto 5"
						class="w-full h-auto object-contain"
					/>
				</div>
				<div
					class="w-full md:w-1/3 shrink-0 px-3 flex items-center justify-center"
				>
					<img
						src={Productos6.src}
						alt="Producto 6"
						class="w-full h-auto object-contain"
					/>
				</div>

				<!-- Last Group (Spacer - All - Spacer) -->
				<div class="hidden md:block md:w-1/3 shrink-0 px-3"></div>
				<div
					class="w-full md:w-1/3 shrink-0 px-3 flex items-center justify-center"
				>
					<img
						src={All.src}
						alt="Todos los productos"
						class="w-full h-auto object-contain"
					/>
				</div>
				<div class="hidden md:block md:w-1/3 shrink-0 px-3"></div>
			</div>
		</div>
	</div>

	<!-- Pagination Circles -->
	<div id="dots-container" class="flex justify-center gap-3 mt-8">
		<!-- Dots injected by JS -->
	</div>

	<!-- Mobile CTA -->
	<div class="md:hidden flex justify-center mt-12">
		<WhatsappParticipa />
	</div>

	<!-- Desktop Bottom Left CTA -->
	<div class="hidden md:block absolute bottom-0 left-0 p-8 z-50">
		<WhatsappParticipa />
	</div>
</section>

<script>
	const track = document.getElementById("carousel-track");
	const prevBtn = document.getElementById("prev-btn");
	const nextBtn = document.getElementById("next-btn");
	const dotsContainer = document.getElementById("dots-container");

	let currentIndex = 0;
	let isMobile = window.matchMedia("(max-width: 768px)").matches;
	let totalSlides = isMobile ? 7 : 3;

	function createDots() {
		if (!dotsContainer) return;
		dotsContainer.innerHTML = "";
		for (let i = 0; i < totalSlides; i++) {
			const btn = document.createElement("button");
			btn.classList.add(
				"carousel-dot",
				"w-3",
				"h-3",
				"rounded-full",
				"border",
				"border-white",
				"transition-all",
				"focus:outline-none",
			);
			// Apply initial color based on index
			btn.style.backgroundColor =
				i === currentIndex ? "white" : "transparent";

			btn.addEventListener("click", () => {
				currentIndex = i;
				updateCarousel();
			});
			dotsContainer.appendChild(btn);
		}
	}

	function updateCarousel() {
		if (!track) return;
		track.style.transform = `translateX(-${currentIndex * 100}%)`;

		// Update dots
		const dots = document.querySelectorAll(".carousel-dot");
		dots.forEach((dot, index) => {
			(dot as HTMLElement).style.backgroundColor =
				index === currentIndex ? "white" : "transparent";
		});
	}

	function handleResize() {
		const newIsMobile = window.matchMedia("(max-width: 768px)").matches;
		if (newIsMobile !== isMobile) {
			// Convert index partially to keep context
			if (newIsMobile) {
				// Switching to mobile
				currentIndex = currentIndex * 3;
				if (currentIndex >= 7) currentIndex = 6;
			} else {
				// Switching to desktop
				currentIndex = Math.floor(currentIndex / 3);
			}

			isMobile = newIsMobile;
			totalSlides = isMobile ? 7 : 3;
			createDots();
			updateCarousel();
		}
	}

	if (prevBtn) {
		prevBtn.addEventListener("click", () => {
			currentIndex =
				currentIndex === 0 ? totalSlides - 1 : currentIndex - 1;
			updateCarousel();
		});
	}

	if (nextBtn) {
		nextBtn.addEventListener("click", () => {
			currentIndex =
				currentIndex === totalSlides - 1 ? 0 : currentIndex + 1;
			updateCarousel();
		});
	}

	window.addEventListener("resize", handleResize);

	// Initialize
	createDots();
	updateCarousel();
</script>
