---
import description from "../assets/video/Video Descripcion.png";
import WhatsappParticipa from "./WhatsappParticipa.astro";
---

<section class="relative my-24 w-full">
	<!-- Background element expanding top and bottom -->
	<div class="absolute inset-x-0 -top-167.5 md:-top-80 xl:-top-90 -bottom-100 bg-white -z-10"></div>

	<div class="container mx-auto px-4">
		<div class="flex flex-col md:flex-row justify-start mb-8">
			<img
				src={description.src}
				alt="Video Descripcion"
				class="h-auto max-w-full md:max-w-lg object-contain"
			/>
			<div class="md:hidden w-full flex flex-col items-center gap-4">
				<WhatsappParticipa />
			</div>
		</div>
		<div class="w-full aspect-video rounded-lg overflow-hidden shadow-xl">
			<video
				id="promo-video"
				class="w-full h-full object-cover"
				controls
				muted
				preload="none"
				playsinline
			>
				<source src="/videos/LalaPlenia.mp4" type="video/mp4" />
				Your browser does not support the video tag.
			</video>
		</div>
	</div>
</section>

<script>
	const video = document.getElementById("promo-video");

	if (video instanceof HTMLVideoElement) {
		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						// Attempt to play only if it's paused to avoid interruptions
						if (video.paused) {
							video.play().catch((e) => console.log("Autoplay prevented:", e));
						}
					} else {
						// Pause when providing out of view
						video.pause();
					}
				});
			},
			{ threshold: 0.5 },
		); // Trigger when 50% of the video is visible

		observer.observe(video);
	}
</script>
